"use strict";(self.webpackChunkenchird_wiki=self.webpackChunkenchird_wiki||[]).push([[7182],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=i.createContext({}),c=function(e){var t=i.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=c(e.components);return i.createElement(d.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,d=e.parentName,s=r(e,["components","mdxType","originalType","parentName"]),p=c(n),m=a,h=p["".concat(d,".").concat(m)]||p[m]||u[m]||l;return n?i.createElement(h,o(o({ref:t},s),{},{components:n})):i.createElement(h,o({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=p;var r={};for(var d in t)hasOwnProperty.call(t,d)&&(r[d]=t[d]);r.originalType=e,r.mdxType="string"==typeof e?e:a,o[1]=r;for(var c=2;c<l;c++)o[c]=n[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2980:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return d},metadata:function(){return c},assets:function(){return s},toc:function(){return u},default:function(){return m}});var i=n(7462),a=n(3366),l=(n(7294),n(3905)),o=["components"],r={sidebar_position:3},d="Querying the Database",c={unversionedId:"rage-store/querying-database",id:"rage-store/querying-database",title:"Querying the Database",description:"Getting a document",source:"@site/docs/rage-store/querying-database.md",sourceDirName:"rage-store",slug:"/rage-store/querying-database",permalink:"/enchird-wiki/docs/rage-store/querying-database",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"The Database",permalink:"/enchird-wiki/docs/rage-store/database"},next:{title:"Guide to using packages",permalink:"/enchird-wiki/docs/guide-to-using-packages"}},s={},u=[{value:"Getting a document",id:"getting-a-document",level:2},{value:"One-time fetching",id:"one-time-fetching",level:3},{value:"Live fetching",id:"live-fetching",level:3},{value:"Modifying a document.",id:"modifying-a-document",level:2},{value:"Deleting a document.",id:"deleting-a-document",level:2},{value:"Fetching documents in a collection (or subcollection)",id:"fetching-documents-in-a-collection-or-subcollection",level:2},{value:"One-time fetch",id:"one-time-fetch",level:3},{value:"Live fetching",id:"live-fetching-1",level:3},{value:"Adding documents to a collection",id:"adding-documents-to-a-collection",level:2},{value:"Adding a single document to a collection",id:"adding-a-single-document-to-a-collection",level:3},{value:"Adding multiple documents.",id:"adding-multiple-documents",level:3},{value:"Querying a collection.",id:"querying-a-collection",level:2}],p={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"querying-the-database"},"Querying the Database"),(0,l.kt)("h2",{id:"getting-a-document"},"Getting a document"),(0,l.kt)("h3",{id:"one-time-fetching"},"One-time fetching"),(0,l.kt)("p",null,"This is done by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".get()")," method on the document reference. For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"db.collection('users').document('AcblELodlfby9392dw').get();\n")),(0,l.kt)("p",null,"will fetch and return the user with ",(0,l.kt)("inlineCode",{parentName:"p"},"id = 'AcblELodlfby9392dw'"),"."),(0,l.kt)("h3",{id:"live-fetching"},"Live fetching"),(0,l.kt)("p",null,"If you want to continue getting updates on the document as changes happen in the database, you can call the ",(0,l.kt)("inlineCode",{parentName:"p"},".onSnapshot()")," method on the document reference. This will return an observable to which you can subscribe to, to get the new document everytime the document is modified in the database. The observable completes if the document is deleted."),(0,l.kt)("p",null,"For example, "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"let user;\n\ndb.collection('user').document('AcblELodlfby9392dw').onSnapshot((result) => {\n    //update the user everytime it is modified.\n    user = result;\n});\n")),(0,l.kt)("p",null,"will keep an up-to-date object that will contain the user data of the user with ",(0,l.kt)("inlineCode",{parentName:"p"},"id = 'AcblELodlfby9392dw'"),"."),(0,l.kt)("h2",{id:"modifying-a-document"},"Modifying a document."),(0,l.kt)("p",null,"To modify a document, the ",(0,l.kt)("inlineCode",{parentName:"p"},".set()")," method has to be called on the document reference. For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"db.collection('user').document('AcblELodlfby9392dw').set({\n    name: \"Mario\",\n    age: 15\n}, true)\n")),(0,l.kt)("p",null,"will update the user with ",(0,l.kt)("inlineCode",{parentName:"p"},"id = 'AcblELodlfby9392dw'"),", changing his name to Mario and his age to 15. If a document with that particular ",(0,l.kt)("inlineCode",{parentName:"p"},"_id")," doesn't exist, a new one is created. "),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},".set()")," method has two parameters:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"document"),": Which is the object containing the attributes we want to write into the document."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"merge"),": Which is a boolean that indicates whether we are merging the attributes passed into ",(0,l.kt)("inlineCode",{parentName:"li"},"document")," to the existing attributes or we are overriding all the data existing in the document to put in this one.")),(0,l.kt)("h2",{id:"deleting-a-document"},"Deleting a document."),(0,l.kt)("p",null,"This is done by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".delete()")," method on the document reference. For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"db.collection('user').document('AcblELodlfby9392dw').delete();\n")),(0,l.kt)("p",null,"will delete the user with ",(0,l.kt)("inlineCode",{parentName:"p"},"id = 'AcblELodlfby9392dw'"),"."),(0,l.kt)("h2",{id:"fetching-documents-in-a-collection-or-subcollection"},"Fetching documents in a collection (or subcollection)"),(0,l.kt)("h3",{id:"one-time-fetch"},"One-time fetch"),(0,l.kt)("p",null,"This is done by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".get()")," method on the collection reference. For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"db.collection('users').get()\n")),(0,l.kt)("p",null,"Will fetch and return all the users in the database once."),(0,l.kt)("h3",{id:"live-fetching-1"},"Live fetching"),(0,l.kt)("p",null,"If you want to continue getting updates on your collection as changes happen in the database, you can call the ",(0,l.kt)("inlineCode",{parentName:"p"},".onSnapshot()")," method on the collection reference. This will return an observable to which you can subscribe to, to get the new results everytime a document in the collection is modified or deleted, or a new document is added to the collection."),(0,l.kt)("p",null,"For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"let users = [];\n\ndb.collection('users').onSnapshot().subscribe((results) => {\n    // Update our results array everytime the users collection is modified.\n    users = results;\n})\n")),(0,l.kt)("p",null,"will keep an up-to-date list of users from the database."),(0,l.kt)("h2",{id:"adding-documents-to-a-collection"},"Adding documents to a collection"),(0,l.kt)("h3",{id:"adding-a-single-document-to-a-collection"},"Adding a single document to a collection"),(0,l.kt)("p",null,"This is done by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".add()")," method on the collection reference, while passing the object as a parameter. "),(0,l.kt)("p",null,"For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"db.collection('users').add({\n    name: \"James\"\n    age: 23\n});\n")),(0,l.kt)("p",null,"will add a user whose name is James and who is 23 years old to the database. If the ",(0,l.kt)("inlineCode",{parentName:"p"},"_id")," parameter is not passed, it creates a new ID for the document."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},".add()")," method takes two parameters:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"document"),": The document to be added to the database."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"force"),": A boolean indicating if we should override any existing document with the same ",(0,l.kt)("inlineCode",{parentName:"li"},"_id"),". If ",(0,l.kt)("inlineCode",{parentName:"li"},"force")," is ",(0,l.kt)("inlineCode",{parentName:"li"},"false")," then the document is not added if one already exists with the ",(0,l.kt)("inlineCode",{parentName:"li"},"_id"),".")),(0,l.kt)("h3",{id:"adding-multiple-documents"},"Adding multiple documents."),(0,l.kt)("p",null,"This is done by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".bulkAdd()")," method on the collection reference. It takes an array of documents to add and a ",(0,l.kt)("inlineCode",{parentName:"p"},"force")," parameter that has the same effect as in the ",(0,l.kt)("inlineCode",{parentName:"p"},".add()")," for all the documents to be added."),(0,l.kt)("h2",{id:"querying-a-collection"},"Querying a collection."),(0,l.kt)("p",null,"You can query a collection by calling the ",(0,l.kt)("inlineCode",{parentName:"p"},".where()")," method on the collection reference. This will return a reference for all the documents that satisfy the query."),(0,l.kt)("p",null,"For example,"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},'db.collection(\'users\').where({\n    selector: {\n        name: "James",\n        age: {$gt: 20}\n    }\n}, ["name", "age"]).get();\n')),(0,l.kt)("p",null,"will select all the users whose name is James and their age is greater than 20."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"where()")," method takes 2 parameters:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"options"),": Which is an object containing options for filtering and sorting the data. It has the following attributes:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"selector")," Defines a selector to filter the results. Required.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$lt")," Match fields \u201cless than\u201d this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$gt")," Match fields \u201cgreater than\u201d this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$lte")," Match fields \u201cless than or equal to\u201d this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$gte")," Match fields \u201cgreater than or equal to\u201d this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$eq")," Match fields equal to this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$ne")," Match fields not equal to this one."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$exists")," True if the field should exist, false otherwise."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$type")," One of: \u201cnull\u201d, \u201cboolean\u201d, \u201cnumber\u201d, \u201cstring\u201d, \u201carray\u201d, or \u201cobject\u201d."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$in")," The document field must exist in the list provided."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$and")," Matches if all the selectors in the array match."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$nin")," The document field must not exist in the list provided."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$all")," Matches an array value if it contains all the elements of the argument array."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$size")," Special condition to match the length of an array field in a document."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$or")," Matches if any of the selectors in the array match. All selectors must use the same index."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$nor")," Matches if none of the selectors in the array match."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$not")," Matches if the given selector does not match."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$mod")," Matches documents where (field % Divisor == Remainder) is true, and only when the document field is an integer."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$regex")," A regular expression pattern to match against the document field."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"$elemMatch")," Matches all documents that contain an array field with at least one element that matches all the specified query criteria."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fields")," (Optional) Defines a list of fields that you want to receive. If omitted, you get the full documents."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"sort")," (Optional) Defines a list of fields defining how you want to sort. Note that sorted fields also have to be selected in the selector."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"limit")," (Optional) Maximum number of documents to return."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"skip")," (Optional) Number of docs to skip before returning."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fields"),": Not to be confused with ",(0,l.kt)("inlineCode",{parentName:"li"},"options.fields")," attribute, this specifies all the fields used in the ",(0,l.kt)("inlineCode",{parentName:"li"},"options.selector")," attribute for performance reasons.")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},".where()")," method returns a collection reference so both ",(0,l.kt)("inlineCode",{parentName:"p"},".get()")," and ",(0,l.kt)("inlineCode",{parentName:"p"},".onSnapshot()")," can be called on it. If ",(0,l.kt)("inlineCode",{parentName:"p"},"onSnapshot()")," is called, it will always send the updated result set if the documents corresponding to the where query change (modified, deleted) or one is added."))}m.isMDXComponent=!0}}]);