"use strict";(self.webpackChunkenchird_wiki=self.webpackChunkenchird_wiki||[]).push([[8358],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,f=u["".concat(l,".").concat(h)]||u[h]||c[h]||i;return n?r.createElement(f,o(o({ref:t},d),{},{components:n})):r.createElement(f,o({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3172:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},assets:function(){return d},toc:function(){return c},default:function(){return h}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={sidebar_position:6,title:"The start up process"},l="Start up",p={unversionedId:"nudle/desktop/startup",id:"nudle/desktop/startup",title:"The start up process",description:"Creating the app window",source:"@site/docs/nudle/desktop/startup.md",sourceDirName:"nudle/desktop",slug:"/nudle/desktop/startup",permalink:"/enchird-wiki/docs/nudle/desktop/startup",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"The start up process"},sidebar:"tutorialSidebar",previous:{title:"Render process",permalink:"/enchird-wiki/docs/nudle/desktop/render-process"},next:{title:"State management",permalink:"/enchird-wiki/docs/nudle/desktop/state-management"}},d={},c=[{value:"Creating the app window",id:"creating-the-app-window",level:2},{value:"Loading the UI",id:"loading-the-ui",level:2},{value:"Why Back up?",id:"why-back-up",level:2}],u={toc:c};function h(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"start-up"},"Start up"),(0,i.kt)("h2",{id:"creating-the-app-window"},"Creating the app window"),(0,i.kt)("p",null,"When the app is launched (when the user clicks on the app icon or when the developer runs ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn run dev"),"), The main function in the main process entry file is run then the following processes "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"A Logger service instance is created and we set a path to save log files."),(0,i.kt)("li",{parentName:"ol"},"When the application is ready, the main app window is created"),(0,i.kt)("li",{parentName:"ol"},"The is Nudle service handler is first attached to the created window. This is important for ipc listeners and events. "),(0,i.kt)("li",{parentName:"ol"},"Nudle services are initialized.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"async function main() {\n  const logger = new LoggerModule()\n  logger.initialize(app.getPath('userData'));\n\n  app.whenReady().then(() => {\n    const mainWindow = createWindow();\n\n    serviceHandler.setWindow(mainWindow);\n    // start services\n    serviceHandler.startServices();\n  });\n}\n")),(0,i.kt)("h2",{id:"loading-the-ui"},"Loading the UI"),(0,i.kt)("p",null,"When the Browser widow has fully initialized, the browser window loads the UI. The first view to be loaded is the ",(0,i.kt)("inlineCode",{parentName:"p"},"App.vue")," which is the entry point of our vue application. Once the ",(0,i.kt)("inlineCode",{parentName:"p"},"App.vue")," has been created:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"It loads the settings to vue store and then set's the default the language of the app from the settings config."),(0,i.kt)("li",{parentName:"ol"},"We initialize a listener that listen for backup data request from the main process and sends the idb database as a serialized json data.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"...\ncreated() {\n    // Get settings and set the default language\n    this.$store.dispatch('loadSettings')\n    .then((settings) => {\n      this.getLang(settings.lang)\n    })\n\n    // listen for back up events from the main process\n    this.$ipcRenderer.on('APP::BACKUP_REQUEST', () => {\n      DB.exportDatabase()\n        .then((json) => {\n          // send database json back to main process\n          this.$ipcRenderer.send('APP::BACKUP_REQUEST_REPLY', json)\n        })\n        .catch((err) => {\n          console.error(err)\n        })\n    })\n  }\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"App.vue")," is created, the router is initialized, which loads the ",(0,i.kt)("inlineCode",{parentName:"p"},"splashscreen.vue")," view in the path ",(0,i.kt)("inlineCode",{parentName:"p"},"src/renderer/views/splashscreen.vue"),". Once the Splash screen view has been mounted, it displays a loader on the UI and the following check is done:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Check if database is empty and tries to restore it from backup (if the ",(0,i.kt)("inlineCode",{parentName:"li"},"_nudle-db.bck")," backup file exist exists) if not it redirects the app to the set up page."),(0,i.kt)("li",{parentName:"ol"},"If no users exist in the database, We need at least one admin for the app to function, so we will redirect to set up page and or if the application has not been configured, redirect to set up page"),(0,i.kt)("li",{parentName:"ol"},"If the database exist and a user exist, Nudle will redirect to the login page")),(0,i.kt)("p",null,"See the code in the ",(0,i.kt)("inlineCode",{parentName:"p"},"initializeApp")," function in the ",(0,i.kt)("inlineCode",{parentName:"p"},"splashscreen.vue")," file."),(0,i.kt)("h2",{id:"why-back-up"},"Why Back up?"),(0,i.kt)("p",null,"Usually (on windows), the indexedDb database can be cleared by a malware or antivirus software, this is be pernicious for our users.\nSo as an effect, Nudle backups the database to the file system every hour in the ",(0,i.kt)("inlineCode",{parentName:"p"},"$NUDLE_CONFIG_DIR")," (in dev ",(0,i.kt)("inlineCode",{parentName:"p"},"./nudle/_nudle-db.bck"),", in prod ",(0,i.kt)("inlineCode",{parentName:"p"},"$USER_DATA/.nudle/_nudle-db.bck")," ",(0,i.kt)("br",null),"\nThis is make sure we don't loose the user's data in any case. Nudle checks if the database exist on start up, then it attempts to find a backup file and restore the data."))}h.isMDXComponent=!0}}]);